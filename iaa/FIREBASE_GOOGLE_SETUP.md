# Firebase Google認証セットアップガイド

## 概要

このガイドでは、Firebase AuthenticationでGoogleプロバイダーを有効化し、Googleアカウントでのログイン機能を設定する方法を説明します。

## 設定手順

### 1. Firebase ConsoleでGoogleプロバイダーを有効化

1. [Firebase Console](https://console.firebase.google.com/)にアクセス
2. プロジェクトを選択
3. 「Authentication」をクリック
4. 「Sign-in method」タブを選択
5. 「Google」をクリック
6. 「有効にする」をクリック
7. **プロジェクトのサポートメール**を設定（必須）
8. 「保存」をクリック

### 2. OAuth同意画面の設定

1. [Google Cloud Console](https://console.cloud.google.com/)にアクセス
2. Firebaseプロジェクトと同じプロジェクトを選択
3. 「APIとサービス」→「OAuth同意画面」を選択
4. 「外部」または「内部」を選択（組織外のユーザーがアクセスする場合は「外部」）
5. 以下の情報を入力：
   - **アプリ名**: Goal Tracker（または任意の名前）
   - **ユーザーサポートメール**: あなたのメールアドレス
   - **デベロッパーの連絡先情報**: あなたのメールアドレス
6. 「保存して次へ」をクリック
7. スコープはデフォルトのまま「保存して次へ」
8. テストユーザーを追加（開発中の場合）または「保存して次へ」
9. 「ダッシュボードに戻る」をクリック

### 3. 承認済みドメインの設定

1. Firebase Consoleで「Authentication」→「設定」タブを選択
2. 「承認済みドメイン」セクションで以下を確認：
   - `localhost`（開発用）
   - 本番ドメイン（デプロイ時）

### 4. Web SDK設定の確認

1. Firebase Consoleで「プロジェクトの設定」をクリック
2. 「全般」タブでWebアプリの設定を確認
3. 必要に応じて、`.env`ファイルの設定を更新

## 実装済み機能

### Googleログイン機能

- **ポップアップ認証**: `signInWithPopup`を使用した安全な認証
- **スコープ設定**: メールアドレスとプロフィール情報へのアクセス
- **エラーハンドリング**: 日本語エラーメッセージ対応

### UI/UX改善

- **Googleブランドボタン**: 公式デザインガイドラインに準拠
- **視覚的分離**: メール/パスワードとGoogleログインの明確な区別
- **ローディング状態**: 認証処理中の視覚的フィードバック
- **状態インジケーター**: 利用可能な認証方法の表示

## エラーハンドリング

以下のエラーケースに対応しています：

- **ポップアップブロック**: ブラウザでポップアップがブロックされた場合
- **ユーザーキャンセル**: ユーザーがログインをキャンセルした場合
- **重複ポップアップ**: 既に別のポップアップが開いている場合
- **アカウント競合**: 同じメールアドレスで異なる方法で登録されている場合

## セキュリティ考慮事項

### 推奨設定

1. **HTTPS使用**: 本番環境では必ずHTTPSを使用
2. **ドメイン制限**: 承認済みドメインのみでアクセス可能に設定
3. **OAuth同意画面**: 適切なアプリ情報を設定

### 開発時の注意点

1. **テストユーザー**: 開発中はテストユーザーを追加
2. **ローカルホスト**: `localhost:5174`などの開発用ドメインを承認済みに追加
3. **デバッグ**: ブラウザの開発者ツールでネットワークエラーを確認

## トラブルシューティング

### よくある問題

1. **「ポップアップがブロックされています」エラー**
   - ブラウザのポップアップブロックを無効化
   - サイトを信頼済みサイトに追加

2. **「このアプリは確認されていません」警告**
   - OAuth同意画面でアプリ情報を適切に設定
   - 本番環境ではGoogleによる確認が必要

3. **「リダイレクトURI不一致」エラー**
   - Firebase Consoleで承認済みドメインを確認
   - 開発用と本番用のドメインを両方追加

4. **認証は成功するがデータが保存されない**
   - Firestoreのセキュリティルールを確認
   - ユーザーIDが正しく設定されているか確認

### デバッグ方法

1. **ブラウザの開発者ツール**
   - Consoleタブでエラーメッセージを確認
   - NetworkタブでFirebase APIの呼び出しを確認

2. **Firebase Console**
   - Authentication > Users でユーザー情報を確認
   - Firestore > Data でデータが正しく保存されているか確認

3. **ログ出力**
   - アプリケーション内でFirebaseのエラーをキャッチしてログ出力

## 本番環境での設定

### 必須設定

1. **カスタムドメイン**: 本番ドメインを承認済みドメインに追加
2. **OAuth同意画面**: 本番用のアプリ情報を設定
3. **プライバシーポリシー**: 必要に応じてプライバシーポリシーページを作成
4. **利用規約**: 必要に応じて利用規約ページを作成

### パフォーマンス最適化

1. **認証状態の永続化**: ユーザーのログイン状態を適切に管理
2. **エラー処理**: ネットワークエラー時の適切な処理
3. **ローディング状態**: 認証処理中の適切なUI表示

## テスト手順

### 機能テスト

1. **Googleログイン**: Googleアカウントでログインできることを確認
2. **データ保存**: ログイン後に目標データが正しく保存されることを確認
3. **ログアウト**: ログアウト後にデータアクセスが制限されることを確認
4. **エラー処理**: 各種エラーケースでの適切なメッセージ表示を確認

### セキュリティテスト

1. **未認証アクセス**: ログインなしでデータにアクセスできないことを確認
2. **他ユーザーデータ**: 他のユーザーのデータにアクセスできないことを確認
3. **セッション管理**: ログアウト後にセッションが適切に終了することを確認

これで、Googleアカウントでの安全で使いやすいログイン機能が利用できるようになります！
